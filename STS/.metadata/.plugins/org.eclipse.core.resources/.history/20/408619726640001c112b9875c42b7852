package kr.erp.controller;

import javax.inject.Inject;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import kr.erp.service.EmailService;
import kr.erp.vo.EmailDTO;
import lombok.AllArgsConstructor;
import lombok.extern.log4j.Log4j;

@Log4j
@Controller
@RequestMapping("/email/*")
@AllArgsConstructor
public class EmailController {
	 @Inject
	    EmailService emailService; // 서비스를 호출하기위한 의존성 주입
	 
	 @GetMapping("send")
	 public void send() 
	 {
		 
	 }
	 
	 @PostMapping("/send")
	 public String send(@ModelAttribute EmailDTO dto, Model model) {
		 try {
			 
	            emailService.sendMail(dto); // dto (메일관련 정보)를 sendMail에 저장함
	            model.addAttribute("message", "이메일이 발송되었습니다."); // 이메일이 발송되었다는 메시지를 출력시킨다.
	 
	        } catch (Exception e) {
	            e.printStackTrace();
	            model.addAttribute("message", "이메일 발송 실패..."); // 이메일 발송이 실패되었다는 메시지를 출력
	        }
	        return "/email/result"; // 실패했으므로 다시 write jsp 페이지로 이동함
		 
	 }
}
